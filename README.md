# PDF标准文档分类系统

基于mb6.png模板的PDF标准文档自动识别和分类系统。

## 功能特性

### 核心功能
- **模板特征提取**: 基于mb6.png模板提取标准文档的特征信息
- **PDF文档分类**: 自动识别PDF文档是否符合标准文档格式
- **批量处理**: 支持批量处理目录中的所有PDF文件
- **智能筛选**: 将符合标准的PDF文档自动复制到jc文件夹

### 特征识别
系统基于以下特征进行标准文档识别：

#### 1. 布局结构特征
- **蓝色框布局**: 检测上、中、下三个蓝色框
- **红色框布局**: 检测1-6号红色框的位置和大小
- **留白比例**: 
  - 上部留白比例 > 30%
  - 中部留白比例 > 50%
  - 下部留白比例 > 50%

#### 2. 文字内容特征
- **上部文字**: 必须包含"标准"二字
- **下部文字**: 必须包含"发布"二字
- **横线检测**: 必须包含第一横线和第二横线

#### 3. 颜色特征
- **底色**: 白色底色
- **字体**: 黑色字体
- **排除元素**: 排除蓝色框、蓝色汉字和蓝色数字1-6

#### 4. 布局要求
- **1号框**: 标准logo位于页面右上角
- **2号框**: 标准类别文字贯穿左右
- **3号框**: 标准编号在第一横线上方靠右，第一横线贯穿左右
- **4号框**: 标准名称和英文翻译至少2行
- **5号框**: 包含"发布"和"实施"二字，分别位于第二横线左右
- **6号框**: 发布单位位于页面下部正中间

## 系统要求

### 软件依赖
- Python 3.7+
- OpenCV 4.8.1+
- Tesseract OCR
- PyMuPDF 1.23.8+
- 其他依赖见requirements.txt

### 安装步骤

1. **安装Python依赖**
```bash
pip install -r requirements.txt
```

2. **安装Tesseract OCR**
   - Windows: 下载并安装 [Tesseract for Windows](https://github.com/UB-Mannheim/tesseract/wiki)
   - Linux: `sudo apt-get install tesseract-ocr`
   - macOS: `brew install tesseract`

3. **安装中文语言包**
   - 确保Tesseract包含中文语言包(chi_sim)

## 使用方法

### 1. 测试特征提取
```bash
python test_features.py
```
这将测试mb6.png模板的特征提取功能，并生成可视化结果。

### 2. 处理单个目录
```bash
python main.py [输入目录路径]
```
如果不指定路径，默认处理当前目录。

### 3. 处理示例
```bash
# 处理当前目录
python main.py

# 处理指定目录
python main.py /path/to/pdf/files
```

## 文件结构

```
pdfClassify/
├── main.py                 # 主程序文件
├── pdf_processor.py        # PDF处理器和特征提取器
├── test_features.py        # 特征提取测试脚本
├── mb6.png                # 标准文档模板
├── requirements.txt        # Python依赖
├── README.md              # 说明文档
├── jc/                    # 标准文档输出目录
└── results/               # 结果文件目录
```

## 核心算法

### 特征提取算法
1. **颜色检测**: 使用HSV颜色空间检测蓝色框和红色框
2. **文字识别**: 使用Tesseract OCR识别中文文字
3. **横线检测**: 使用霍夫变换检测水平直线
4. **布局分析**: 分析图片上中下三部分的留白比例

### 分类算法
1. **关键特征检查**: 验证必须存在的特征
2. **布局比例验证**: 检查留白比例是否符合要求
3. **文字内容验证**: 确保包含必要的关键词汇

## 输出结果

### 处理结果
- 符合标准的PDF文件将被复制到`jc/`文件夹
- 控制台显示处理进度和结果统计

### 测试输出
- `feature_visualization.png`: 特征检测可视化结果
- 控制台输出详细的特征提取信息

## 配置说明

### OCR配置
系统使用以下Tesseract配置进行文字识别：
```
--oem 3 --psm 6 -c tessedit_char_whitelist=0123456789标准发布实施年月日
```

### 颜色检测参数
- **蓝色范围**: HSV(100-130, 50-255, 50-255)
- **红色范围**: HSV(0-10, 50-255, 50-255) 和 HSV(170-180, 50-255, 50-255)

### 布局阈值
- **上部留白**: > 30%
- **中部留白**: > 50%
- **下部留白**: > 50%
- **白色背景**: > 60%
- **黑色文字**: > 1%

## 故障排除

### 常见问题

1. **Tesseract未找到**
   - 确保Tesseract已正确安装
   - Windows用户可能需要设置环境变量

2. **OCR识别不准确**
   - 确保图片分辨率足够高
   - 检查图片是否清晰

3. **特征检测失败**
   - 检查图片颜色是否符合要求
   - 验证图片格式是否支持

### 调试模式
运行测试脚本查看详细的特征提取信息：
```bash
python test_features.py
```

## 技术细节

### 依赖库说明
- **OpenCV**: 图像处理和计算机视觉
- **PyMuPDF**: PDF文件读取和处理
- **Tesseract**: OCR文字识别
- **NumPy**: 数值计算
- **Pillow**: 图像处理

### 性能优化
- 只处理PDF前5页以提高速度
- 使用2倍分辨率提高OCR准确率
- 批量处理减少重复初始化

## 标准识别规范

### 核心特征(四要素)

本系统基于mb6.png模板，通过以下四个核心要素识别企业标准文档：

#### 1. 三区结构：上/中/下分区符合比例约束
- **上部区域**：包含蓝色标注框"上"，留白占比 > 30%
- **中部区域**：包含蓝色标注框"中"，留白占比 > 50%  
- **下部区域**：包含蓝色标注框"下"，留白占比 > 50%

#### 2. 双贯穿线：水平线位置如右图所示
- **第一横线**：贯穿上部区域底部（3号框下方），长度 > 页面宽度90%
- **第二横线**：贯穿下部区域顶部（5号框内），长度 > 页面宽度90%
- **位置精度**：横线位置误差 < 5%

#### 3. 关键字：必须包含"标准"和"发布"
- **上部"标准"**：使用Tesseract OCR（--psm 6配置）在上部区域检测
- **下部"发布"**：5号框必含"发布"字样，6号框尾部含"发布"字样
- **OCR配置**：`--oem 3 --psm 6 -l chi_sim`

#### 4. 文本布局：符合模板位置逻辑树
- **1号框（logo）**：右上角坐标 > 页面宽度85%
- **3号框（编号）**：文本右对齐，右边界 > 页面宽度80%
- **4号框（名称）**：文本行数 ≥ 2（中英文各一行）
- **5号框（日期）**：实施日期在第二横线右侧
- **6号框（单位）**：居中显示，水平中心点误差 ≤ 5%

### 模板示意图

![标准模板示意图](mb6.png)

*图：mb6.png标注版 - 展示了蓝色区域框（上/中/下）和红色关键框（1-6号）的标准布局*

### 颜色识别参数

#### 排除元素（仅用于训练）
- **蓝色标注框**：HSV范围 (100-130, 50-255, 50-255)
- **红色数字框**：HSV范围 (0-10, 50-255, 50-255) 和 (170-180, 50-255, 50-255)
- **实际处理**：系统会过滤这些训练标注，只处理白底黑字内容

#### 有效内容识别
- **白色背景**：RGB ≥ 230，占比 > 95%
- **黑色文本**：排除蓝框/蓝字后的文字区域，占比 > 1%

### 匹配阈值设置

#### 结构相似度要求
- **区域位置误差** < 7%
- **留白比例误差** < 10%
- **横线长度精度** > 90%
- **关键框位置精度** ≤ 5%

#### 性能参数
- **单PDF处理超时** ≤ 15秒
- **页面扫描范围**：前5页
- **图像转换分辨率**：300 DPI

## 版本信息

- **版本**: 2.0.0
- **作者**: PDF标准文档分类系统
- **更新日期**: 2024年
- **模板版本**: mb6.png (企业标准特征模板)

## 许可证

本项目采用MIT许可证。

