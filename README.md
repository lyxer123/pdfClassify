# PDF标准文档分类系统

## 项目简介

本项目是一个基于计算机视觉的PDF标准文档自动识别和分类系统。系统能够扫描指定驱动器下的所有PDF文件，通过分析文档的7个关键特征来判断是否为标准文档，并将符合条件的标准文档自动拷贝到指定文件夹。

## 功能特点

### 🔍 智能特征检测
- **6个关键特征识别**：标准logo、标准类别、标准号和横线、标准名称、发布时间、发布单位
- **精确位置检测**：基于相对位置关系进行特征识别
- **模板比对**：与标准模板进行蒙版比对，提高识别准确率
- **多页分析**：支持多页PDF文档，自动选择最佳匹配页面

### 📁 批量处理
- **递归搜索**：自动扫描指定驱动器下的所有PDF文件
- **智能分类**：将符合条件的标准文档自动拷贝到目标文件夹
- **第一页处理**：仅处理每个PDF文件的第一页，提高处理速度
- **进度显示**：实时显示处理进度和结果统计
- **错误处理**：完善的异常处理机制，确保程序稳定运行

### 🎯 高精度识别
- **多重验证**：特征数量、关键特征、位置符合度、模板相似度四重验证
- **自适应阈值**：根据文档质量自动调整识别参数
- **详细报告**：提供详细的检测结果和失败原因分析
- **快速处理**：仅处理第一页，大幅提升处理速度

## 系统要求

### 环境要求
- Python 3.7+
- Windows 10/11
- 至少2GB可用内存

### 依赖库
```bash
pip install opencv-python
pip install numpy
pip install Pillow
pip install PyMuPDF
pip install pathlib
```

## 安装和使用

### 1. 克隆项目
```bash
git clone https://github.com/lyxer123/pdfClassify.git
cd pdfClassify
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 运行程序
```bash
python pdf_processor.py
```

## 配置说明

### 主要参数
- `source_drive`: 源驱动器路径（默认：E:）
- `target_folder`: 目标文件夹（默认：jc）
- `template_path`: 模板图片路径（默认：mb3.png）

### 检测标准（基于mb4.png）
- **特征数量要求**：6个特征中必须检测到≥5个
- **关键特征要求**：特征3（标准号和横线）、特征4（标准名称）、特征5（发布时间）中至少满足2个
- **位置符合度**：基于confidence值计算，要求>0.6
- **模板相似度**：与标准模板比对，相似度要求>0.2

## 6个特征详解

### 1. 标准logo
- **位置**：页面上部靠右
- **检测方法**：识别上部右侧区域的图形元素

### 2. 标准类别
- **位置**：页面上部，左右贯穿
- **检测方法**：识别上部宽度较大的文本区域

### 3. 标准号和横线
- **位置**：页面上部靠右
- **检测方法**：识别上部右侧的编号文本和横线，标准号在横线上方

### 4. 标准的中文和英文名称
- **位置**：页面正中间
- **检测方法**：识别中间区域的多行文本（≥2行）

### 5. 发布和实施时间
- **位置**：页面下部
- **检测方法**：检测下部横线及横线上方左右两侧的文本

### 6. 发布单位
- **位置**：页面下部
- **检测方法**：识别下部区域的文本信息

**注意**：系统仅处理PDF文件的第一页进行特征检测，这通常足以识别标准文档的封面页。系统基于mb4.png模板进行检测。

## 文件结构

```
pdfClassify/
├── main.py                 # 核心特征提取模块
├── pdf_processor.py        # PDF处理主程序
├── visualization.py        # 可视化工具
├── mb4.png               # 标准模板图片
├── jc/                   # 输出文件夹
├── README.md             # 项目说明文档
└── requirements.txt      # 依赖库列表
```

## 使用示例

### 基本使用
```python
from pdf_processor import PDFProcessor

# 创建处理器实例
processor = PDFProcessor(source_drive="E:", target_folder="jc")

# 执行批量处理
processor.process_all()
```

### 自定义配置
```python
# 修改源驱动器和目标文件夹
processor = PDFProcessor(source_drive="D:", target_folder="standard_docs")

# 处理单个PDF文件
result = processor.process_pdf("path/to/document.pdf")
```

## 输出结果

### 处理统计
```
PDF 文件批量处理 - E:盘扫描（仅第一页）
==================================================
正在搜索 E: 盘下的所有PDF文件...
总共找到 150 个PDF文件

[1/150] document1.pdf
  第一页: 5/6 特征
     ✅ 第一页满足条件（特征数5>=5，关键特征齐全，位置符合度0.85，模板相似度0.45）
  📋 已拷贝到: jc/document1.pdf

处理完成!
总文件数: 150
成功拷贝: 23
拷贝的文件保存在: D:\GitHub\pdfClassify\jc
注意: 仅处理了每个PDF文件的第一页
```

### 详细检测报告
```
❌ 第一页不满足条件
     特征3（标准号和横线）: ✅
   特征4（标准名称）: ❌
   特征5（发布时间）: ✅
   总特征数>=5: ❌
  位置符合度: 0.65
  模板相似度: 0.25
```

## 技术原理

### 图像处理流程
1. **PDF转图像**：使用PyMuPDF将PDF页面转换为高分辨率图像
2. **预处理**：灰度化、二值化、形态学操作
3. **特征检测**：
   - 霍夫变换检测直线
   - 连通组件分析检测文本区域
   - 轮廓检测识别图形元素
4. **位置分析**：基于相对位置关系进行特征匹配
5. **模板比对**：使用模板匹配算法进行相似度计算

### 检测算法
- **文本区域检测**：基于连通组件分析和密度计算
- **直线检测**：使用霍夫变换检测水平线条
- **位置验证**：基于页面比例的区域划分和位置验证
- **相似度计算**：使用归一化相关系数进行模板匹配

## 性能优化

### 内存管理
- 及时释放临时图像文件
- 使用生成器处理大文件列表
- 优化图像处理参数

### 处理速度
- 多线程处理（可选）
- 智能跳过不符合条件的文件
- 缓存检测结果

## 故障排除

### 常见问题

**Q: 程序无法找到PDF文件**
A: 检查驱动器路径是否正确，确保有访问权限

**Q: 检测准确率不高**
A: 调整检测参数，检查模板图片质量

**Q: 内存不足**
A: 减少同时处理的文件数量，优化图像分辨率

**Q: 权限错误**
A: 以管理员身份运行程序，检查文件夹权限

### 调试模式
```python
# 启用详细日志
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 更新日志

### v1.0.0 (2025-08-06)
- 初始版本发布
- 实现7个特征检测
- 添加模板比对功能
- 支持批量处理

## 贡献指南

欢迎提交Issue和Pull Request来改进项目！

### 开发环境设置
1. Fork项目
2. 创建功能分支
3. 提交更改
4. 创建Pull Request

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 联系方式

- 项目主页：https://github.com/lyxer123/pdfClassify
- 问题反馈：https://github.com/lyxer123/pdfClassify/issues
- 邮箱：yongxiangliu@gmail.com

---

**注意**：本系统仅用于标准文档的自动识别和分类，请确保遵守相关法律法规和版权要求。
